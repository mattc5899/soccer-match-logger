# -*- coding: utf-8 -*-
"""âš½è¶³çƒè³½æ³è¨˜éŒ„å™¨

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1oQAdXia6WQPs7tOa4wMqAHh_0638BsYB
"""

import streamlit as st
import pandas as pd # å¼•å…¥ pandas æ˜¯ç‚ºäº†è®“ dataframeé¡¯ç¤ºæ›´æ¼‚äº®

# ==============================================================================
# 1. [ç‹€æ…‹ä¿å­˜] åˆå§‹åŒ–ç‹€æ…‹
# Streamlit æ¯æ¬¡äº’å‹•éƒ½æœƒé‡è·‘ç¨‹å¼ï¼Œæ‰€ä»¥å¿…é ˆæª¢æŸ¥ session_state æ˜¯å¦å·²å­˜åœ¨è³‡æ–™
# ==============================================================================

# åˆå§‹åŒ–äº‹ä»¶åˆ—è¡¨ï¼šé€™æ˜¯æˆ‘å€‘çš„å°å‹è³‡æ–™åº«ï¼Œå­˜åœ¨è¨˜æ†¶é«”ä¸­
if 'events' not in st.session_state:
    st.session_state['events'] = [] # [ç‹€æ…‹ä¿å­˜] é€™è£¡å»ºç«‹ç©ºåˆ—è¡¨ï¼Œç¢ºä¿é‡è·‘æ™‚è³‡æ–™ä¸æœƒæ¶ˆå¤±

# åˆå§‹åŒ–éšŠä¼åç¨±é è¨­å€¼
if 'home_team' not in st.session_state:
    st.session_state['home_team'] = "ä¸»éšŠ"
if 'away_team' not in st.session_state:
    st.session_state['away_team'] = "å®¢éšŠ"

# ==============================================================================
# 2. ä»‹é¢æ¨™é¡Œ
# ==============================================================================
st.title("âš½ è¶³çƒè³½æ³è¨˜éŒ„å™¨")

# ==============================================================================
# 3. å´é‚Šæ¬„ï¼šéšŠä¼è¨­å®š & é€²çƒç´€éŒ„è¡¨å–®
# ==============================================================================
with st.sidebar:
    st.header("1. éšŠä¼è¨­å®š")
    # [ç‹€æ…‹ä¿å­˜] ä½¿ç”¨ key åƒæ•¸å°‡è¼¸å…¥æ¡†ç›´æ¥ç¶å®šåˆ° session_state
    home_name = st.text_input("ä¸»éšŠåç¨±", key='home_team')
    away_name = st.text_input("å®¢éšŠåç¨±", key='away_team')

    st.divider() # åˆ†éš”ç·š

    st.header("2. ç´€éŒ„æ“ä½œ")

    # å»ºç«‹ä¸€å€‹å¯æŠ˜ç–Šçš„å€å¡Š (Expander)
    with st.expander("ç´€éŒ„é€²çƒ", expanded=True):

        # --- è¡¨å–®è¼¸å…¥å…ƒä»¶ ---
        # é¸é …æœƒéš¨è‘—ä¸Šé¢çš„éšŠä¼åç¨±å‹•æ…‹æ”¹è®Š
        team_input = st.radio("é€²çƒçƒéšŠ", [home_name, away_name])

        time_input = st.number_input("é€²çƒæ™‚é–“ (åˆ†é˜)", min_value=0, max_value=125, step=1)

        zone_input = st.selectbox("é€²çƒå€åŸŸ", ["å·¦è·¯", "ä¸­è·¯", "å³è·¯", "å®šä½çƒ"])

        type_input = st.selectbox("é€²çƒæ–¹å¼", ["å°„é–€", "é ­æ§Œ", "é»çƒ"])

        # ç‚ºäº†è³‡æ–™å®Œæ•´æ€§ï¼Œæˆ‘ä¿ç•™äº†åŸæœ¬é‚è¼¯ä¸­çš„çƒå“¡æ¬„ä½
        scorer_input = st.text_input("å¾—åˆ†çƒå“¡")
        assist_input = st.text_input("åŠ©æ”»çƒå“¡ (é¸å¡«)", value="ç„¡")

        # --- [ç‹€æ…‹ä¿å­˜] å¯«å…¥æ•¸æ“šçš„æ ¸å¿ƒé‚è¼¯ ---
        if st.button("ç¢ºèªé€²çƒ"):
            # 1. å°‡æ”¶é›†åˆ°çš„è®Šæ•¸åŒ…è£æˆå­—å…¸ (Dictionary)
            new_event = {
                'team': team_input,
                'time': time_input,
                'zone': zone_input,
                'type': type_input,
                'scorer': scorer_input,
                'assist': assist_input
            }

            # 2. [ç‹€æ…‹ä¿å­˜] å°‡å­—å…¸ append åˆ° session_state['events'] åˆ—è¡¨ä¸­
            st.session_state['events'].append(new_event)

            # 3. é¡¯ç¤ºæˆåŠŸè¨Šæ¯ (æœƒçŸ­æš«é¡¯ç¤º)
            st.success(f"å·²ç´€éŒ„ï¼š{time_input}' {team_input} é€²çƒï¼")

# ==============================================================================
# 4. ä¸»ç•«é¢ï¼šé¡¯ç¤ºçµæœ
# ==============================================================================

# æª¢æŸ¥æ˜¯å¦æœ‰è³‡æ–™
if len(st.session_state['events']) > 0:
    st.subheader("ğŸ“Š ç›®å‰è³½æ³ç´€éŒ„")

    # [ç‹€æ…‹ä¿å­˜] å¾ session_state ä¸­è®€å–æ‰€æœ‰è³‡æ–™ä¸¦é¡¯ç¤º
    # ä½¿ç”¨ Pandas DataFrame å¯ä»¥è®“è¡¨æ ¼å¯ä»¥æ’åºã€æ”¾å¤§
    df = pd.DataFrame(st.session_state['events'])

    # èª¿æ•´æ¬„ä½é¡¯ç¤ºé †åºï¼ˆç¾è§€ç”¨ï¼‰
    st.dataframe(
        df,
        column_config={
            "team": "çƒéšŠ",
            "time": "æ™‚é–“ (åˆ†)",
            "zone": "å€åŸŸ",
            "type": "æ–¹å¼",
            "scorer": "å¾—åˆ†è€…",
            "assist": "åŠ©æ”»"
        },
        use_container_width=True
    )

    # ç°¡å–®é¡¯ç¤ºæœ€æ–°çš„ä¸€ç­†ç´€éŒ„
    last_event = st.session_state['events'][-1]
    st.caption(f"æœ€æ–°å‹•æ…‹ï¼šç¬¬ {last_event['time']} åˆ†é˜ï¼Œ{last_event['scorer']} ({last_event['team']}) å¾—åˆ†ã€‚")

else:
    st.info("ğŸ‘ˆ è«‹åœ¨å´é‚Šæ¬„è¼¸å…¥éšŠä¼åç¨±ï¼Œä¸¦å±•é–‹ã€Œç´€éŒ„é€²çƒã€é–‹å§‹ç´€éŒ„ã€‚")